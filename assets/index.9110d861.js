var I=Object.defineProperty;var j=(r,t,i)=>t in r?I(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i;var e=(r,t,i)=>(j(r,typeof t!="symbol"?t+"":t,i),i);import{P as h,p as v,F as A,A as H}from"./vendor.55cd3a4e.js";const D=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}};D();const R={type:h.AUTO,parent:"game",backgroundColor:"",transparent:!0,scale:{mode:h.Scale.FIT,width:600,height:900,autoCenter:h.Scale.CENTER_BOTH},physics:{default:"matter",matter:{gravity:{y:1}}},seed:["123"]},$={fontFamily:"'Lato', sans-serif",fontSize:"2rem",stroke:"#000",strokeThickness:2};class k extends h.GameObjects.Container{constructor(t,i,s,n,a,o=16711680,d=65280,c=20,l,L,w="left"){super(t,i,s);e(this,"width");e(this,"height");e(this,"graphicMask");e(this,"geometryMask");e(this,"background");e(this,"backgroundColor");e(this,"fill");e(this,"fillColor");e(this,"text");e(this,"icon");e(this,"max");e(this,"current");e(this,"barMax");e(this,"barCurrent");e(this,"incrementAmount");e(this,"getIconCenter",()=>({x:this.x+this.icon.x+this.icon.displayWidth/2,y:this.y+this.icon.y+this.icon.displayHeight/2}));e(this,"setMax",t=>{this.max=t,this.incrementAmount=this.width/this.max,this.barMax=this.incrementAmount*this.max,this.barCurrent=this.current*this.incrementAmount,this.text.text=`${this.current}/${this.max}`,this.scene.tweens.add({targets:this.fill,props:{width:{value:`${this.current*this.incrementAmount}`,duration:300,ease:"Power2"}}})});e(this,"setProgress",t=>{this.current=t,this.barCurrent=t*this.incrementAmount,this.text.text=`${this.current}/${this.max}`,this.scene.tweens.add({targets:this.fill,props:{width:{value:`${this.barCurrent}`,duration:300,ease:"Power2"}}})});e(this,"increaseProgress",t=>{this.current+=t,this.barCurrent+=t*this.incrementAmount,this.text.text=`${this.current}/${this.max}`,this.scene.tweens.add({targets:this.fill,props:{width:{value:`+=${t*this.incrementAmount}`,duration:300,ease:"Power2"}}})});e(this,"decreaseProgress",t=>{this.current-=t,this.barCurrent-=t*this.incrementAmount,this.text.text=`${this.current}/${this.max}`,this.scene.tweens.add({targets:this.fill,props:{width:{value:`-=${t*this.incrementAmount}`,duration:300,ease:"Power2"}}})});this.width=n,this.height=a,this.backgroundColor=o,this.fillColor=d,this.max=c,this.current=l!=null?l:c,this.incrementAmount=n/this.max,this.barMax=this.incrementAmount*this.max,this.barCurrent=this.current*this.incrementAmount,this.graphicMask=new h.GameObjects.Graphics(t).fillRoundedRect(w==="left"?this.width/7+i:i,s,this.width/7*6,a,10),this.geometryMask=new v.exports.Display.Masks.GeometryMask(t,this.graphicMask),this.background=new h.GameObjects.Rectangle(t,w==="left"?this.width/7:0,0,this.width/7*6,a,o).setOrigin(0).setMask(this.geometryMask),this.add(this.background),this.fill=new h.GameObjects.Rectangle(t,w==="left"?this.width/7:0,0,this.barCurrent,a,d).setOrigin(0).setMask(this.geometryMask),this.add(this.fill),this.icon=new h.GameObjects.Sprite(this.scene,w==="left"?0:this.width/7*6+5,5,L).setOrigin(0),this.add(this.icon),this.icon.displayWidth=this.width/7-5,this.icon.displayHeight=this.height-10,this.icon.setTintFill(this.fillColor),this.text=new h.GameObjects.Text(t,w==="left"?this.width/2+this.width/7/2:this.width/2-this.width/7/2,a/2,`${this.current}/${this.max}`,$).setOrigin(.5),this.add(this.text)}}const E=6,f=Math.floor(600/E);class m extends h.GameObjects.Container{constructor(t,i,s,n,a){super(t,s+f/4,n);e(this,"id");e(this,"column");e(this,"intersector");e(this,"intersectoryOverlay");e(this,"shouldAnimate",!1);e(this,"pointerDownFunc",(t,i,s,n)=>{h.Geom.Circle.ContainsPoint(new h.Geom.Circle(this.x,this.y,Math.floor(f/2*.8)),t)&&this.scene.events.emit("setStartingDragTile",this)});e(this,"pointerMoveFunc",(t,i,s,n)=>{h.Geom.Circle.ContainsPoint(new h.Geom.Circle(this.x,this.y,Math.floor(f/2*.8)),t)&&this.scene.events.emit("draggingIntersect",this)});e(this,"pointerUpFunc",(t,i,s,n)=>{});e(this,"onSetDim",()=>{this.alpha=.3});e(this,"onUnsetDim",()=>{this.alpha=1});this.setSize(f,f),this.on("pointerup",this.pointerUpFunc),this.on("pointerdown",this.pointerDownFunc),this.on("pointermove",this.pointerMoveFunc),this.on("dim",this.onSetDim),this.on("undim",this.onUnsetDim),this.setInteractive(),this.id=i,this.column=a}}const F=6,B=Math.floor(600/F);class T extends Phaser.GameObjects.Sprite{constructor(t,i){super(t,0,0,i);this.setOrigin(0),this.setDisplaySize(B,B)}}const N={fontFamily:"'Lato', sans-serif",fontSize:"1.5rem",stroke:"#000",strokeThickness:5};class W extends m{constructor(t){super(t.scene,t.id,t.x,t.y,t.column);e(this,"tileType","enemy");e(this,"tileName","skull");e(this,"maxHp");e(this,"level");e(this,"xpReward");e(this,"damage");e(this,"spawnedThisTurn");e(this,"sprite");e(this,"text");e(this,"destroy",()=>new Promise((t,i)=>{var a,o;let s=this.scene.add.sprite(this.x,this.y,this.tileName);s.displayHeight=this.height,s.displayWidth=this.width;const n=this.scene;super.destroy(),n.tweens.add({targets:s,props:{x:{value:(a=n.xpBar)==null?void 0:a.getIconCenter().x,duration:400,ease:"Sine"},y:{value:(o=n.xpBar)==null?void 0:o.getIconCenter().y,duration:400,ease:"Power2"},scale:{value:.1,duration:400,ease:"Power2"}},onComplete:(d,c)=>(c.forEach(l=>l.destroy()),t())})}));e(this,"attackAnimation",t=>new Promise((i,s)=>{this.bringToTop(this.sprite),this.bringToTop(this.text),this.scene.tweens.add({targets:[this.sprite,this.text],ease:"Quint.easeInOut",duration:150,props:{y:{value:"-=50"}},yoyo:!0,onComplete:()=>i()})}));this.maxHp=5,this.level=3,this.xpReward=4,this.damage=1,this.spawnedThisTurn=!0,this.setDataEnabled(),this.data.set("currentHp",5),this.sprite=new T(t.scene,this.tileName),this.sprite.setOrigin(.5),this.add(this.sprite),this.text=new h.GameObjects.Text(t.scene,-this.displayOriginX,this.displayOriginY/2-5,`${this.currentHp}`,N),this.text.setDepth(100),this.add(this.text),this.data.events.on("changedata-currentHp",()=>{this.text.text=`${this.currentHp}`})}get currentHp(){return this.data.get("currentHp")}set currentHp(t){this.data.set("currentHp",t)}}class X extends m{constructor(t){super(t.scene,t.id,t.x,t.y,t.column);e(this,"tileType","combat");e(this,"tileName","sword");e(this,"damage");e(this,"sprite");this.damage=1,this.sprite=new T(t.scene,this.tileName),this.sprite.setOrigin(.5),this.add(this.sprite)}}class q extends m{constructor(t){super(t.scene,t.id,t.x,t.y,t.column);e(this,"tileType","healing");e(this,"tileName","healthPotion");e(this,"healAmount");e(this,"sprite");e(this,"destroy",()=>new Promise((t,i)=>{var a,o;let s=this.scene.add.sprite(this.x,this.y,this.tileName);s.displayHeight=this.height,s.displayWidth=this.width;const n=this.scene;super.destroy(),n.tweens.add({targets:s,props:{x:{value:(a=n.healthBar)==null?void 0:a.getIconCenter().x,duration:400,ease:"Sine"},y:{value:(o=n.healthBar)==null?void 0:o.getIconCenter().y,duration:400,ease:"Power2"},scale:{value:.1,duration:400,ease:"Power2"}},onComplete:(d,c)=>(c.forEach(l=>l.destroy()),t())})}));this.healAmount=2,this.sprite=new T(t.scene,this.tileName),this.sprite.setOrigin(.5),this.add(this.sprite)}}class _ extends m{constructor(t){super(t.scene,t.id,t.x,t.y,t.column);e(this,"tileType","defence");e(this,"tileName","shield");e(this,"defenceMod");e(this,"sprite");e(this,"destroy",()=>new Promise((t,i)=>{var a,o;let s=this.scene.add.sprite(this.x,this.y,this.tileName);s.displayHeight=this.height,s.displayWidth=this.width;const n=this.scene;super.destroy(),n.tweens.add({targets:s,props:{x:{value:(a=n.defenceBar)==null?void 0:a.getIconCenter().x,duration:400,ease:"Sine"},y:{value:(o=n.defenceBar)==null?void 0:o.getIconCenter().y,duration:400,ease:"Power2"},scale:{value:.1,duration:400,ease:"Power2"}},onComplete:(d,c)=>(c.forEach(l=>l.destroy()),t())})}));this.defenceMod=1,this.sprite=new T(t.scene,this.tileName),this.sprite.setOrigin(.5),this.add(this.sprite)}}class U extends m{constructor(t){super(t.scene,t.id,t.x,t.y,t.column);e(this,"tileType","currency");e(this,"tileName","coin");e(this,"goldValue");e(this,"sprite");e(this,"destroy",()=>new Promise((t,i)=>{let s=this.scene.add.sprite(this.x,this.y,this.tileName);s.displayHeight=this.height,s.displayWidth=this.width;const n=this.scene;super.destroy(),n.tweens.add({targets:s,props:{x:{value:n.goldIcon.x+22,duration:400,ease:"Sine"},y:{value:n.goldIcon.y+22,duration:400,ease:"Power2"},scale:{value:.1,duration:400,ease:"Power2"}},onComplete:(a,o)=>(o.forEach(d=>d.destroy()),t())})}));this.goldValue=v.exports.Math.Between(1,6),this.sprite=new T(t.scene,this.tileName),this.sprite.setOrigin(.5),this.add(this.sprite)}}const z=6,V=Math.floor(600/z),p={enemy:{lower:0,upper:15},combat:{lower:16,upper:35},healing:{lower:36,upper:60},defence:{lower:61,upper:80},currency:{lower:81,upper:100}};class Y{constructor(t){e(this,"scene");e(this,"currentDelta",0);e(this,"GenerateRandomTile",(t,i=200)=>{this.currentDelta++;const s=new m(this.scene,this.currentDelta,t*V,i,t);switch(K()){case"enemy":return new W(s);case"combat":return new X(s);case"healing":return new q(s);case"defence":return new _(s);case"currency":return new U(s);default:throw new Error("INVALID TILE TYPE :(")}});this.scene=t}}const K=()=>{const r=h.Math.RND.between(0,100);if(r>=p.enemy.lower&&r<=p.enemy.upper)return"enemy";if(r>=p.combat.lower&&r<=p.combat.upper)return"combat";if(r>=p.healing.lower&&r<=p.healing.upper)return"healing";if(r>=p.defence.lower&&r<=p.defence.upper)return"defence";if(r>=p.currency.lower&&r<=p.currency.upper)return"currency";throw new Error("Out of bounds generator with weightings")},x=r=>r.tileType==="enemy",Q=r=>r.tileType==="healing",J=r=>r.tileType==="currency",Z=r=>r.tileType==="combat",tt=r=>r.tileType==="defence";class et extends A{constructor(t){super();e(this,"game");e(this,"tilesToRemove");e(this,"next_playerTurn",()=>"tileActions");e(this,"enter_playerTurn",()=>{console.log(this.game.tiles)});e(this,"exit_playerTurn",()=>{});e(this,"next_tileActions",()=>"removeAndReplaceTile");e(this,"enter_tileActions",()=>{const t=this.game.selectedTiles.filter(i=>i.tileType=="combat").length;this.game.selectedTiles.forEach((i,s)=>{x(i)&&(i.currentHp-=t+this.game.playerDamage,i.currentHp<=0&&(this.game.playerXp+=i.xpReward,this.tilesToRemove.push(i))),Q(i)&&(this.game.playerCurrentHp+=i.healAmount,this.game.playerCurrentHp>this.game.playerHp?this.game.playerCurrentHp=this.game.playerHp:i.shouldAnimate=!0,this.tilesToRemove.push(i)),Z(i)&&this.tilesToRemove.push(i),J(i)&&(this.game.playerGold+=i.goldValue,i.shouldAnimate=!0,this.tilesToRemove.push(i)),tt(i)&&(this.game.playerCurrentShield+=i.defenceMod,this.game.playerCurrentShield>this.game.playerShield?this.game.playerCurrentShield=this.game.playerShield:i.shouldAnimate=!0,this.tilesToRemove.push(i))}),this.next()});e(this,"exit_tileActions",()=>{});e(this,"next_removeAndReplaceTile",()=>"enemyTurn");e(this,"enter_removeAndReplaceTile",async()=>{const t=[];this.tilesToRemove.forEach(async(i,s)=>{var a;this.game.tiles=[...this.game.tiles.filter(o=>o.id!==i.id)],t.push(i.destroy());var n=this.game.tileFactory.GenerateRandomTile(i.column);this.game.tiles.push(n),(a=this.game.tilesLayer)==null||a.add(this.game.tiles[this.game.tiles.length-1]),this.game.matter.add.gameObject(this.game.tiles[this.game.tiles.length-1])}),await Promise.all(t),this.next()});e(this,"exit_removeAndReplaceTile",()=>{this.tilesToRemove=[]});e(this,"next_enemyTurn",()=>"playerTurn");e(this,"enter_enemyTurn",async()=>{var i;let t=[];((i=this.game.tiles)==null?void 0:i.some(s=>x(s)))&&this.game.tiles.filter(n=>x(n)).forEach((n,a)=>{const o=n;if(o.spawnedThisTurn){o.spawnedThisTurn=!1;return}if(t.push(o.attackAnimation()),this.game.playerCurrentShield>0){this.game.playerCurrentShield-=1;return}this.game.playerCurrentHp-=o.damage}),await Promise.all(t),this.next()});e(this,"exit_enemyTurn",()=>{});this.game=t,this.tilesToRemove=[]}}const it=()=>{const r=550;let t=[];for(let i=0;i<200;i++)if(i===0)t.push(0);else if(i===1)t.push(0);else{let s=i+80,n=Math.floor(Math.pow(r*(i*1.016),s*.008));t.push(Math.floor(n/9+t[i-1]))}return console.log(t),t},P=it(),st=(r,t)=>t>=P[r+1];var nt={XpTable:P,DidLevelUp:st};const rt={fontFamily:"'Lato', sans-serif",fontSize:"2rem",stroke:"#000",strokeThickness:2};class at extends h.GameObjects.Container{constructor(t,i,s,n,a,o=16711680,d=65280,c,l="left"){super(t,i,s);e(this,"width");e(this,"height");e(this,"graphicMask");e(this,"geometryMask");e(this,"background");e(this,"backgroundColor");e(this,"fill");e(this,"fillColor");e(this,"text");e(this,"icon");e(this,"max");e(this,"current");e(this,"barMax");e(this,"barCurrent");e(this,"incrementAmount");e(this,"getIconCenter",()=>({x:this.x+this.icon.x+this.icon.displayWidth/2,y:this.y+this.icon.y+this.icon.displayHeight/2}));e(this,"setProgress",t=>{this.current=t,this.barCurrent=Math.floor(this.max/100*t),this.text.text=`${t}%`,this.scene.tweens.add({targets:this.fill,props:{width:{value:`${this.barCurrent}`,duration:300,ease:"Power2"}}})});e(this,"increaseProgress",t=>{this.current+=t,this.barCurrent+=t*this.incrementAmount,this.text.text=`${this.current}/${this.max}`,this.scene.tweens.add({targets:this.fill,props:{width:{value:`+=${t*this.incrementAmount}`,duration:300,ease:"Power2"}}})});e(this,"decreaseProgress",t=>{this.current-=t,this.barCurrent-=t*this.incrementAmount,this.text.text=`${this.current}/${this.max}`,this.scene.tweens.add({targets:this.fill,props:{width:{value:`-=${t*this.incrementAmount}`,duration:300,ease:"Power2"}}})});this.width=n,this.height=a,this.backgroundColor=o,this.fillColor=d,this.max=n/7*6,this.current=0,this.incrementAmount=n/7*6/this.max,this.barMax=this.incrementAmount*this.max,this.barCurrent=this.current*this.incrementAmount,this.graphicMask=new h.GameObjects.Graphics(t).fillRoundedRect(l==="left"?this.width/7+i:i,s,this.width/7*6,a,10),this.geometryMask=new v.exports.Display.Masks.GeometryMask(t,this.graphicMask),this.background=new h.GameObjects.Rectangle(t,l==="left"?this.width/7:0,0,this.width/7*6,a,o).setOrigin(0).setMask(this.geometryMask),this.add(this.background),this.fill=new h.GameObjects.Rectangle(t,l==="left"?this.width/7:0,0,this.barCurrent,a,d).setOrigin(0).setMask(this.geometryMask),this.add(this.fill),this.icon=new h.GameObjects.Sprite(this.scene,l==="left"?0:this.width/7*6+5,5,c).setOrigin(0),this.add(this.icon),this.icon.displayWidth=this.width/7-5,this.icon.displayHeight=this.height-10,this.icon.setTintFill(this.fillColor),this.text=new h.GameObjects.Text(t,l==="left"?this.width/2+this.width/7/2:this.width/2-this.width/7/2,a/2,`${Math.floor(this.current/this.max)}%`,rt).setOrigin(.5),this.add(this.text)}}var u;(function(r){r[r.None=0]="None",r[r.Equipment=1]="Equipment",r[r.Stats=2]="Stats",r[r.Options=3]="Options"})(u||(u={}));const ht=r=>{switch(r){case 1:return"equipmentIcon";case 2:return"statsIcon";case 3:return"optionsIcon";default:throw new Error("Invalid window type given")}};class C extends h.GameObjects.Container{constructor(t,i,s,n,a){super(t,i,s);e(this,"rectangle");e(this,"graphicMask");e(this,"text");e(this,"icon");e(this,"color",4144959);e(this,"overColor",16777200);e(this,"downColor",16777215);e(this,"originalColour",5921899);e(this,"windowBind");e(this,"onClickCallback");e(this,"setColors",(t,i,s)=>{this.overColor=i,this.color=t,this.downColor=s});e(this,"over",()=>{this.rectangle.setFillStyle(this.overColor)});e(this,"down",()=>{this.rectangle.setFillStyle(this.downColor)});e(this,"out",()=>{this.rectangle.setFillStyle(this.color)});e(this,"up",()=>{this.rectangle.setFillStyle(this.overColor),this.parentContainer.emit("windowButtonPress",this.windowBind)});this.height=n,this.width=n,this.windowBind=a,this.rectangle=new h.GameObjects.Rectangle(t,0,0,n,n,this.color).setInteractive().setOrigin(0).on("pointerover",this.over).on("pointerdown",this.down).on("pointerup",this.up).on("pointerout",this.out),this.add(this.rectangle),this.graphicMask=new h.GameObjects.Graphics(t).fillRoundedRect(this.rectangle.x,this.rectangle.y,n,n,10);const o=this.graphicMask.createGeometryMask();this.add(this.graphicMask),this.rectangle.setMask(o),this.icon=new h.GameObjects.Sprite(t,5,5,ht(a)),this.icon.displayWidth=n-10,this.icon.displayHeight=n-10,this.icon.setOrigin(0),this.add(this.icon)}}const ot=6,y=Math.floor(600/ot);class G extends Phaser.GameObjects.Container{constructor(t,i){super(t,y*3,y*3);e(this,"window");e(this,"windowGeom");e(this,"handleWindowEvent",t=>{t===this.window&&this.visible?this.setVisible(!1):t===this.window&&!this.visible?this.setVisible(!0):this.setVisible(!1)});this.width=y*6,this.height=y*6,this.window=i,this.windowGeom=new Phaser.Geom.Rectangle(0,0,y*6,y*6),this.setInteractive(),this.setVisible(!1),this.on("windowListener",this.handleWindowEvent),this.on("pointerDown",s=>console.log(s))}}class lt extends G{constructor(t){super(t,u.Equipment);e(this,"bg");this.setInteractive(),this.bg=new Phaser.GameObjects.Rectangle(t,this.windowGeom.x,this.windowGeom.y,this.windowGeom.width,this.windowGeom.height,16711680),this.bg.setInteractive(),this.add(this.bg)}}class dt extends G{constructor(t){super(t,u.Options);e(this,"bg");this.setInteractive(),this.bg=new Phaser.GameObjects.Rectangle(t,this.windowGeom.x,this.windowGeom.y,this.windowGeom.width,this.windowGeom.height,16711935),this.bg.setInteractive(),this.add(this.bg)}}class ct extends G{constructor(t){super(t,u.Stats);e(this,"bg");this.setInteractive(),this.bg=new Phaser.GameObjects.Rectangle(t,this.windowGeom.x,this.windowGeom.y,this.windowGeom.width,this.windowGeom.height,16776960),this.bg.setInteractive(),this.add(this.bg)}}const pt=6,b=Math.floor(600/pt),S=(r,t,i,s=1)=>(r-t*i)/(i+1)*s+(s-1)*t;class ut extends Phaser.GameObjects.Container{constructor(t,i,s){super(t,i,s);e(this,"buttonContainerBg");e(this,"buttonContainer");e(this,"windowContainer");e(this,"windowContainerBg");e(this,"windows");e(this,"windowButtons");e(this,"equipmentWindow");e(this,"equipmentButton");e(this,"statsWindow");e(this,"statsButton");e(this,"optionsWindow");e(this,"optionsButton");e(this,"activeWindow",u.None);e(this,"handleWindowChange",t=>{this.windowContainer.iterate(i=>{i.emit("windowListener",t)})});this.height=b*6+100,this.width=b*6,this.windows=t.add.group(),this.windowButtons=t.add.group(),this.windowContainerBg=new Phaser.GameObjects.Graphics(t),this.windowContainerBg.fillStyle(65280,0),this.windowContainerBg.fillRect(0,0,this.width,this.height-100),this.add(this.windowContainerBg),this.windowContainer=new Phaser.GameObjects.Container(t,0,0),this.windowContainer.width=this.width,this.windowContainer.height=this.height-100,this.add(this.windowContainer),this.buttonContainerBg=new Phaser.GameObjects.Graphics(t),this.buttonContainerBg.fillStyle(3356219),this.buttonContainerBg.fillRect(0,b*6,this.width,100),this.add(this.buttonContainerBg),this.buttonContainer=new Phaser.GameObjects.Container(t,0,b*6),this.buttonContainer.width=this.width,this.buttonContainer.height=100,this.buttonContainer.on("windowButtonPress",this.handleWindowChange),this.add(this.buttonContainer),this.equipmentWindow=new lt(t),this.windowContainer.add(this.equipmentWindow),this.equipmentButton=new C(t,S(this.buttonContainer.width,this.buttonContainer.height-10,3,1),5,this.buttonContainer.height-10,u.Equipment),this.buttonContainer.add(this.equipmentButton),this.statsWindow=new ct(t),this.windowContainer.add(this.statsWindow),this.statsButton=new C(t,S(this.buttonContainer.width,this.buttonContainer.height-10,3,2),5,this.buttonContainer.height-10,u.Stats),this.buttonContainer.add(this.statsButton),this.optionsWindow=new dt(t),this.windowContainer.add(this.optionsWindow),this.optionsButton=new C(t,S(this.buttonContainer.width,this.buttonContainer.height-10,3,3),5,this.buttonContainer.height-10,u.Options),this.buttonContainer.add(this.optionsButton),t.add.existing(this)}}const O={fontFamily:"'Lato', sans-serif",fontSize:"2rem",stroke:"#000",strokeThickness:2},M=6,g=Math.floor(600/M);class gt extends h.Scene{constructor(){super("GameScene");e(this,"state");e(this,"xpTable");e(this,"collisionGroup");e(this,"tileFactory");e(this,"isDragging",!1);e(this,"dragPoints",[]);e(this,"selectedTiles",[]);e(this,"dragLine");e(this,"dragLineFill");e(this,"dragLinePath");e(this,"startingTileType");e(this,"tiles",[]);e(this,"tileBoxGraphic");e(this,"tilesLayer");e(this,"tilesLayerMask");e(this,"healthBar");e(this,"defenceBar");e(this,"xpBar");e(this,"goldIcon");e(this,"goldText");e(this,"levelIcon");e(this,"levelText");e(this,"bottomBar");e(this,"preload",()=>{this.load.image("coin","assets/coin.svg"),this.load.image("sword","assets/gladius.svg"),this.load.image("healthPotion","assets/health-potion.svg"),this.load.image("shield","assets/shield.svg"),this.load.image("skull","assets/skull-white.svg"),this.load.image("healthCross","assets/health-cross.svg"),this.load.image("xpIcon","assets/xp-icon.svg"),this.load.image("defenceIcon","assets/defence-icon.svg"),this.load.image("moneyBag","assets/money-bag.svg"),this.load.image("optionsIcon","assets/options-button-icon.svg"),this.load.image("statsIcon","assets/stats-button-icon.svg"),this.load.image("equipmentIcon","assets/equipment-button-icon.svg"),this.load.spritesheet("slash","assets/slashes_meme.png",{frameWidth:64,frameHeight:64})});e(this,"create",()=>{this.initializeDataAccessors(),this.state=new et(this),this.buildUi(),this.buildGrid(),this.registerCollisions(),this.registerHandlers(),this.registerAnimations(),this.state.start("playerTurn")});e(this,"update",(t,i)=>{});e(this,"buildUi",()=>{this.healthBar=new k(this,Math.floor(this.sys.canvas.width/2),5,Math.floor(this.sys.canvas.width/2-20),50,2600544,3066993,30,30,"healthCross","left"),this.add.existing(this.healthBar),this.defenceBar=new k(this,Math.floor(this.sys.canvas.width/2),70,Math.floor(this.sys.canvas.width/2-20),50,2719929,3447003,10,10,"defenceIcon","left"),this.add.existing(this.defenceBar),this.xpBar=new at(this,Math.floor(this.sys.canvas.width/2),135,Math.floor(this.sys.canvas.width/2-20),50,9323693,10840509,"xpIcon","left"),this.add.existing(this.xpBar),this.levelIcon=new h.GameObjects.Text(this,10,70,"Lv.",O).setOrigin(0),this.add.existing(this.levelIcon),this.levelText=new h.GameObjects.Text(this,50,70,`${this.data.get("playerLevel")}`,O).setOrigin(0),this.add.existing(this.levelText),this.goldIcon=new h.GameObjects.Sprite(this,10,135,"moneyBag").setTintFill(15844367).setOrigin(0),this.goldIcon.displayHeight=35,this.goldIcon.displayWidth=35,this.add.existing(this.goldIcon),this.goldText=new h.GameObjects.Text(this,50,135,`${this.data.get("playerGold")}`,O).setOrigin(0),this.add.existing(this.goldText),this.tileBoxGraphic=new h.GameObjects.Rectangle(this,0,200,g*6,g*6,2899536).setOrigin(0).setDepth(-1).setName("container-mask"),this.add.existing(this.tileBoxGraphic),this.tilesLayer=this.add.layer();const t=new h.GameObjects.Graphics(this);t.fillRect(0,200,g*6,g*6),this.tilesLayerMask=t.createGeometryMask(),this.tilesLayer.setMask(this.tilesLayerMask),this.bottomBar=new ut(this,0,200)});e(this,"buildGrid",()=>{var s;let t=0;for(let n=0;n<M;n++)for(let a=0;a<M;a++){var i=this.tileFactory.GenerateRandomTile(n,a);x(i)&&(i.spawnedThisTurn=!1),this.tiles.push(i),(s=this.tilesLayer)==null||s.add(this.tiles[t]),t++}});e(this,"updateDragLine",(t=!1)=>{var i,s,n,a;t&&(this.selectedTiles.pop(),this.dragPoints.pop()),(i=this.dragLine)==null||i.clear(),(s=this.dragLine)==null||s.lineStyle(16,0,1),(n=this.dragLineFill)==null||n.clear(),(a=this.dragLineFill)==null||a.lineStyle(8,16777215,1),this.dragLinePath=new h.Curves.Path(this.selectedTiles[0].x,this.selectedTiles[0].y),this.dragLinePath.splineTo(this.dragPoints.map(o=>new h.Math.Vector2(o.x,o.y))),this.dragLinePath.draw(this.dragLine,128),this.dragLinePath.draw(this.dragLineFill,128)});e(this,"dimTiles",t=>{this.checkMatchingTileType(t)&&this.tiles.filter(i=>!this.checkMatchingTileType(i.tileType)).forEach((i,s)=>i.emit("dim"))});e(this,"undimTiles",t=>{this.checkMatchingTileType(t)&&this.tiles.filter(i=>!this.checkMatchingTileType(i.tileType)).forEach((i,s)=>i.emit("undim"))});e(this,"initializeDataAccessors",()=>{this.data.set("playerDamage",1),this.data.set("playerHp",30),this.events.on("changedata-playerHp",(t,i)=>{var s;(s=this.healthBar)==null||s.setMax(i)}),this.data.set("playerCurrentHp",30),this.events.on("changedata-playerCurrentHp",(t,i)=>{var s;(s=this.healthBar)==null||s.setProgress(i)}),this.data.set("playerShield",10),this.events.on("changedata-playerShield",(t,i)=>{var s;(s=this.defenceBar)==null||s.setMax(i)}),this.data.set("playerCurrentShield",10),this.events.on("changedata-playerCurrentShield",(t,i)=>{var s;(s=this.defenceBar)==null||s.setProgress(i)}),this.data.set("playerLevel",1),this.events.on("changedata-playerLevel",(t,i)=>{var s;(s=this.levelText)==null||s.setText(i.toString())}),this.data.set("playerXp",0),this.events.on("changedata-playerXp",(t,i)=>{var s;this.playerXp>this.xpTable[this.playerLevel+1]&&(console.log("levelled up"),this.playerLevel++,this.levelUpThreshhold=this.xpTable[this.playerLevel+1]),(s=this.xpBar)==null||s.setProgress(Math.floor((this.playerXp-this.xpTable[this.playerLevel])/(this.xpTable[this.playerLevel+1]-this.xpTable[this.playerLevel])*100))}),this.data.set("levelUpThreshhold",this.xpTable[this.playerLevel+1]),this.events.on("changedata-levelUpThreshhold",(t,i)=>{}),this.data.set("playerGold",0),this.events.on("changedata-playerGold",(t,i)=>{var s;(s=this.goldText)==null||s.setText(i.toString())})});e(this,"registerCollisions",()=>{this.matter.world.setBounds(),this.matter.add.rectangle(0,232+g*6,this.sys.canvas.width*2,64,{isStatic:!0}),this.tiles.forEach((t,i)=>{this.matter.add.gameObject(t)})});e(this,"registerHandlers",()=>{this.events.on("setStartingDragTile",t=>{var i;((i=this.state)==null?void 0:i.state)==="playerTurn"&&(this.startingTileType=t.tileType,this.selectedTiles.push(t),this.dragPoints.push({x:t.x,y:t.y}),this.dragLine=this.add.graphics(),this.dragLineFill=this.add.graphics(),this.dimTiles(this.startingTileType))}),this.events.on("draggingIntersect",t=>{var i;if(((i=this.state)==null?void 0:i.state)==="playerTurn"){if(this.selectedTiles.length<1)return;if(this.selectedTiles.some(s=>s.id==t.id))this.selectedTiles.length>1&&t.id==this.selectedTiles[this.selectedTiles.length-2].id&&this.updateDragLine(!0);else{let s=t.x-this.dragPoints[this.dragPoints.length-1].x,n=t.y-this.dragPoints[this.dragPoints.length-1].y;n>g*1.2||n<-(g*1.2)||s>g*1.2||s<-(g*1.2)?console.log("DISTANCE TOO LARGE"):(this.checkIntersectedTile(t),this.updateDragLine())}}}),this.input.on("pointerup",t=>{var i,s,n,a,o;((i=this.state)==null?void 0:i.state)==="playerTurn"&&(this.selectedTiles.length>2&&((s=this.state)==null||s.next()),this.selectedTiles=[],this.dragPoints=[],(n=this.dragLine)==null||n.destroy(),(a=this.dragLinePath)==null||a.destroy(),(o=this.dragLineFill)==null||o.destroy(),this.undimTiles(this.startingTileType))})});e(this,"registerAnimations",()=>{this.anims.create({key:"slash",frames:this.anims.generateFrameNumbers("slash",{frames:[0,1,2,3,4,5,6,7,8]})})});e(this,"checkMatchingTileType",t=>{switch(t){case"combat":if(this.startingTileType==="enemy"||this.startingTileType==="combat")return!0;case"enemy":if(this.startingTileType==="enemy"||this.startingTileType==="combat")return!0;case"currency":if(this.startingTileType==t)return!0;case"defence":if(this.startingTileType==t)return!0;case"healing":if(this.startingTileType==t)return!0}});e(this,"checkIntersectedTile",t=>{this.checkMatchingTileType(t.tileType)&&(this.selectedTiles.push(t),this.dragPoints.push({x:t.x,y:t.y}))});this.tileFactory=new Y(this),this.xpTable=nt.XpTable}get playerHp(){return this.data.get("playerHp")}set playerHp(t){this.data.set("playerHp",t)}get playerCurrentHp(){return this.data.get("playerCurrentHp")}set playerCurrentHp(t){this.data.set("playerCurrentHp",t)}get playerShield(){return this.data.get("playerShield")}set playerShield(t){this.data.set("playerShield",t)}get playerCurrentShield(){return this.data.get("playerCurrentShield")}set playerCurrentShield(t){this.data.set("playerCurrentShield",t)}get playerXp(){return this.data.get("playerXp")}set playerXp(t){this.data.set("playerXp",t)}get levelUpThreshhold(){return this.data.get("levelUpThreshhold")}set levelUpThreshhold(t){this.data.set("levelUpThreshhold",t)}get playerGold(){return this.data.get("playerGold")}set playerGold(t){this.data.set("playerGold",t)}get playerLevel(){return this.data.get("playerLevel")}set playerLevel(t){this.data.set("playerLevel",t)}get playerDamage(){return this.data.get("playerDamage")}set playerDamage(t){this.data.set("playerDamage",t)}}H.addListener("backButton",r=>{console.log("back")});new h.Game(Object.assign(R,{scene:[gt]}));
